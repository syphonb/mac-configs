---
- name: Install reflector
  become: true
  ansible.builtin.pacman:
    name: reflector
    state: present
    update_cache: true

- name: Refresh pacman mirrors
  command: >
    reflector --country AU --latest 10 --sort rate
    --save /etc/pacman.d/mirrorlist
  changed_when: false

- name: Update system
  become: true
  ansible.builtin.pacman:
    update_cache: true
    upgrade: true

- name: Install base build tools
  become: true
  ansible.builtin.pacman:
    name:
      - base-devel
      - git
      - go
    state: present

- name: Allow passwordless sudo for dev user (for provisioning)
  become: true
  copy:
    dest: /etc/sudoers.d/99-dev-user
    content: "{{ dev_user }} ALL=(ALL) NOPASSWD: ALL\n"
    mode: "0440"
    validate: "visudo -cf %s"
